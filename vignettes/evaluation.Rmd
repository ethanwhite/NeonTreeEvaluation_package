---
title: "Benchmark Evaluation"
author: "Ben Weinstein"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{evaluation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE
)
```

# Submission Format

The format of the submission is as follows

* A csv file
* 5 columns: Plot Name, xmin, ymin, xmax, ymax

Each row contains information for one predicted bounding box.

The plot column should be named the same as the files in the dataset (e.g. SJER_021)

```{r}
library(dplyr)
library(NeonTreeEvaluation)
library(reshape2)
library(ggplot2)

submission<-read.csv(system.file("extdata", "Weinstein2019.csv",package = "NeonTreeEvaluation"))
head(submission)
```

# Evaluation

For each plot compute the precision and recall based on intersection-over-union of 0.5 between the ground truth bounding boxes and the predicted boxes. The loop through all matching plot_names and produce evaluation scores

```{r,eval=FALSE}
results<-evaluate_benchmark(submission = submission)
```

There are several options that need to be considered. see ?evaluate_benchmark. For example, `project_boxes` asks whether the predicted boxes should be projected in universal-transverse mercator projection (UTM) from the image coordinate system. For example,

```{r}
head(submission)
```

These boxes are in the image coorinate system. The xmin of the first box is 299.53 (pixels) from the top left. The images are projected and have units in meters. Therefore we need to transform the image coordinates to the geograpgic coordinates for the boxes to overlap. 

For the sake of computation in this small vignette, let's select just 5 images.

```{r,include=FALSE}
results<-submission %>% filter(plot_name %in% sample(plot_name,5)) %>% group_by(plot_name) %>% do(evaluate_plot(.,project_boxes = T))
```

```{r}
df<-melt(results)
ggplot(df,aes(y=value,x=variable)) + geom_boxplot()
```

